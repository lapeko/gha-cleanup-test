name: Clean old caches

on:
  schedule:
    - cron: "0 2 * * *"
  workflow_dispatch:
    inputs:
      keep_count:
        description: "Number of caches to keep per group"
        required: false
        default: "2"
        type: string

jobs:
  clean:
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install --no-cache-dir PyGithub

      - name: Clean old caches
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          KEEP_COUNT: ${{ inputs.keep_count }}
        run: python .github/scripts/clean_caches.py
